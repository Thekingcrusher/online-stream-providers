{
  "id":"sudatchi",
  "name":"Sudatchi",
  "version":"1.0.3",
  "manifestURI":"https://raw.githubusercontent.com/Thekingcrusher/online-stream-providers/refs/heads/main/sudatchi/manifest.json",
  "language":"typescript",
  "type":"onlinestream-provider",
  "description":"Sudatchi is an online stream provider for both sub and dub (mostly sub only), utilizing ASS subtitles",
  "author":"Thekingcrusher",
  "icon":"https://raw.githubusercontent.com/Thekingcrusher/online-stream-providers/refs/heads/main/sudatchi/logo.ico",
  "lang":"en",
  "payload":"/// \u003creference path=\"./online-streaming-provider.d.ts\" /\u003e\n\nclass Provider {\n  baseUrl = \"https://sudatchi.com\";\n\n  getSettings(): Settings {\n      return {\n          episodeServers: [\"Default\"],\n          supportsDub: false,\n      };\n  }\n\n  async search(query: SearchOptions): Promise\u003cSearchResult[]\u003e {\n    return [{\n      id: `${query.media.id}`,\n      title: query.media.englishTitle || query.media.romajiTitle,\n      url: `${this.baseUrl}/anime/${query.media.id}`,\n      subOrDub: query.dub ? \"dub\" : \"sub\"\n    }];\n  }\n\n  async findEpisodes(id: string): Promise\u003cEpisodeDetails[]\u003e {\n    const res = await fetch(`${this.baseUrl}/api/anime/${id}`);\n    const data = await res.json();\n\n    return data.episodes.map((ep: any) =\u003e ({\n        id,                  // Use anime ID here, NOT `${id}/${ep.number}`\n        number: ep.number,\n        url: `${this.baseUrl}/watch/${id}/${ep.number}`,\n        title: ep.title || \"\",\n    }));\n  }\n\n  async findEpisodeServer(episode: EpisodeDetails, _server: string): Promise\u003cEpisodeServer\u003e {\n    // Fetch episode data using anime ID and episode number separately:\n    const epApi = `${this.baseUrl}/api/episode/${episode.id}/${episode.number}`;\n    const epRes = await fetch(epApi);\n    const epData = await epRes.json();\n\n    // The API returns episodes list â€” find the matching episode by number\n    // Here episode.number is a number, epData.episodes[].number is probably a number too\n    const targetEp = epData?.episodes?.find((e: any) =\u003e e.number === episode.number);\n    if (!targetEp) throw new Error(\"Episode not found\");\n\n    const subApi = await fetch(`${this.baseUrl}/api/subtitles/${targetEp.id}`).then(res =\u003e res.json());\n\n    // Map subtitles to proper format\n    const subtitles = subApi.subtitles.map((sub: any, i: number) =\u003e ({\n        id: sub.lang,\n        url: `${this.baseUrl}${sub.file}`,\n        language: sub.label,\n        isDefault: i === 0,\n    }));\n\n    return {\n        server: \"Default\",\n        headers: {\n          \"Referer\": epApi\n        },\n        videoSources: [{\n          url: `${this.baseUrl}/api/streams?episodeId=${targetEp.id}`,\n          type: \"m3u8\",\n          quality: \"auto\",\n          subtitles\n        }],\n    };\n  }\n}"
}
