{
  "id":"sudatchi",
  "name":"Sudatchi",
  "version":"1.0.0",
  "manifestURI":"https://raw.githubusercontent.com/Thekingcrusher/online-stream-providers/refs/heads/main/sudatchi/manifest.json",
  "language":"typescript",
  "type":"onlinestream-provider",
  "description":"Sudatchi is an online stream provider for both sub and dub (mostly sub only), utilizing ASS subtitles",
  "author":"Thekingcrusher",
  "icon":"https://raw.githubusercontent.com/Thekingcrusher/online-stream-providers/refs/heads/main/sudatchi/logo.png",
  "lang":"en",
  "payload":"/// \u003creference path=\"./online-streaming-provider.d.ts\" /\u003e\n\nclass Provider {\n\n  getSettings(): Settings {\n      return {\n          episodeServers: [\"Default\"],\n          supportsDub: false,\n      };\n  }\n\n  async search(query: SearchOptions): Promise\u003cSearchResult[]\u003e {\n    const res = await fetch(`https://sudatchi-api.vercel.app/api/search?q=${encodeURIComponent(query.query)}`);\n    const data = await res.json();\n\n    return data.media.map((result: any) =\u003e ({\n        id: result.id.toString(),\n        title: result.title.english || result.title.romaji || result.title.native,\n        url: `https://sudatchi.com/anime/${result.id}`,\n        subOrDub: \"sub\",\n    }));\n  }\n\n  async findEpisodes(id: string): Promise\u003cEpisodeDetails[]\u003e {\n    const res = await fetch(`https://sudatchi.com/api/anime/${id}`);\n    const data = await res.json();\n\n    return data.episodes.map((ep: any) =\u003e ({\n        id,                  // Use anime ID here, NOT `${id}/${ep.number}`\n        number: ep.number,\n        url: `https://sudatchi.com/watch/${id}/${ep.number}`,\n        title: ep.title || \"\",\n    }));\n  }\n\n  async findEpisodeServer(episode: EpisodeDetails, _server: string): Promise\u003cEpisodeServer\u003e {\n    // Fetch episode data using anime ID and episode number separately:\n    const epApi = `https://sudatchi.com/api/episode/${episode.id}/${episode.number}`;\n    const epRes = await fetch(epApi);\n    const epData = await epRes.json();\n\n    // The API returns episodes list â€” find the matching episode by number\n    // Here episode.number is a number, epData.episodes[].number is probably a number too\n    const targetEp = epData?.episodes?.find((e: any) =\u003e e.number === episode.number);\n    if (!targetEp) throw new Error(\"Episode not found\");\n\n    // Safely parse subtitlesJson if it's a string\n    let rawSubs: any[] = [];\n    if (epData.subtitlesJson) {\n        try {\n            rawSubs = typeof epData.subtitlesJson === \"string\"\n                ? JSON.parse(epData.subtitlesJson)\n                : epData.subtitlesJson;\n        } catch (e) {\n            console.warn(\"Failed to parse subtitlesJson:\", e);\n        }\n    }\n\n    // Map subtitles to proper format\n    const subtitles = rawSubs.map((sub: any, i: number) =\u003e ({\n        id: sub.lang,\n        url: `https://sudatchi.com/api/proxy/${sub.file.replace(/^\\/ipfs\\//, \"\")}`,\n        language: sub.label,\n        isDefault: i === 0,\n    }));\n\n    return {\n        server: \"Default\",\n        headers: {\n          \"Referer\": epApi\n        },\n        videoSources: [{\n          url: `https://sudatchi.com/api/streams?episodeId=${targetEp.id}`,\n          type: \"m3u8\",\n          quality: \"auto\",\n          subtitles\n        }],\n    };\n  }\n}"
}
